<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript"
	src="jquery/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
$(function(){
	//console.log("Hello");
	loadPosts();
	$('#posts').on('click','.replay',replayComment);
});
var SUCCESS = 1;

function replayComment(){
	//console.log("click");
	var btn = $(this);
	var id = btn.data('id');
	var val = btn.prev().val();
	//console.log(id+" "+val);
	var url = 'post/replay.do';
	var data = {id:id, comment:val};
	$.post(url, data, function(result){
		//console.log(result);
		if(result.state==SUCCESS){
			loadPosts();			
		}else{
			alert(result.message);
		}
	});
}

function loadPosts(){
	var url = 'post/list.do';
	$.getJSON(url, function(result){
		//console.log(result);
		if(result.state==SUCCESS){
			var posts = result.data;
			showPosts(posts);
		}else{
			alert(result.message);
		}
	});	
}
function showPosts(posts){
	//console.log(posts);
	var div = $('#posts').empty();
	for(var i=0; i<posts.length; i++){
		var post=posts[i];
		var h2=$('<h2></h2>').html(post.user.name);
		div.append(h2);
		var p = $('<p></p>').html(post.content + '<br>' +
				post.postTime);
		div.append(p);
		var ul = $('<ul></ul>');
		var comments = post.comments;
		for(var j=0; j<comments.length; j++){
			var c = comments[j];
			var li = $('<li></li>').html(c.name + " " + 
					c.content);
			ul.append(li);
		}
		div.append(ul);
		div.append('<input name="comment" type="text">');
		var btn=$('<input class="replay" type="button" value="回复">');
		btn.data('id', post.id)
		div.append(btn);
	}
}
</script>
</head>
<body>
	<h1>信息列表</h1>
	<div id="posts">
		<h2>李老师</h2>
		<p>今天天气不错 时间</p>
		<ul>
			<li>范传奇: 昨天也很好</li>
		</ul>
		<input name="comment" type="text">
		<input type="button" value="回复">
	</div>	
</body>
</html>





